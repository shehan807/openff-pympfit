---
title: 'PyMPFIT: Multipole Moment-based Partial Charge Assignment'
tags:
  - Python
authors:
  - name: Shehan M. Parmar
    orcid: 0000-0002-2033-0862
    corresponding: true
    affiliation: 1
  - name: Jesse McDaniel
    orcid: 0000-0002-9211-1108
    affiliation: 1
affiliations:
  - name: Georgia Institute of Technology, College of Chemistry and Biochemistry, Atlanta, GA, United States
    index: 1
date: 3 February 2026
bibliography: paper.bib
---

# Summary

`pympfit` is a partial atomic charge assignment package based on fitting molecular point charges to distributed multipole moments computed via the Gaussian distributed multipole analysis (GDMA). The software integrates with Psi4 for quantum chemistry calculations and outputs charge parameters compatible with the Open Force Field software ecosystem. `pympfit` provides two fitting approaches: multi-site, singular value decomposition for single molecules and constrained, nonlinear optimization for enforced equivalence across chemically identical atom types. Furthermore, `pympfit` provides support for flexible Bayesian parameterization of virtual site charges and positions. An SQLite backend stores multipole data, providing suitable applications for parameterizing transferrable force fields for high-throughput molecular dynamics pipelines or featurization of machine learning interatomic potentials (MLIPs).  

# Statement of need

Modern *in silico* materials discoery pipelines depend on mature, high-throughput (HT) software infrastructure. Central to parameterizing classical moelcular dynamics (MD) force fields [@eastman_openmm_2017] and, more recently, featurizing machine learning interatomic potentials (MLIPs) [@wood_uma_2025], is accurately representing the molecular electrostatic potential (ESP). Short- and long-range electrostatic interactions govern critical macroscopic behavior in many condensed-phase and biological materials. Thus, charge assignment remains critical for accurate property prediction across domains, including drugs and proteins [@roos_opls3e_2019], battery electrolytes [mcdaniel_understanding_2019], and polymers [@ruza_benchmarking_2025].

Point charge models have long served as efficient, coarse-grained representations of molecular electrostatics [@mulliken_electronic_1955; gasteiger_iterative1980; @besler_atomic_1990]. ESP-based charge fitting approaches fit quantum mechanical (QM) ESPs onto atomic centers via least-squares regression, with relevant methods such as CHELPG [@breneman_determining_1990], RESP [@bayly_well-behaved_1993], and AM1-BCC [@jakalian_fast_2000] widely adopted for force field development. However, ESP-based methods are prone to an inherent ill-posedness due to multiple point charge distributions reproducing the same molecular potential, a challenge most severe in the presence of "buried atoms". Conformational dependence further complicates charge transferrability across a wide range of chemistries [@ferenczy_charges_1991].  

To this end, we introduce `pympfit`, an implementation of the original MPFIT algorithm [@ferenczy_charges_1991; @chipot_transferable_1993] that fits point charges to the ESP generated by *multipole moments* from the Gaussian distributed multipole analysis (GDMA) [@stone_distributed_1981]. Despite the demonstrated research impact of GDMA-based point charges for  *ab initio* and polarizable force field development [@misquitta_ab_2016; @mcdaniel_ab_2016; @wu_automation_2012],
open-source software support remains limited. `pympfit` addresses this gap by providing force-field-agnostic, user-friendly partial charge assignment protocols implemented in tandem with mainstream, Open Force Field standards and best practices in mind.

# State of the field

Modern molecular simulation software depend on generating partial charges to compute inescapable Coulomb charge-charge interactions, resulting in a rich and diverse ecosystem of tools across methods. For instance, ESP-based methods remain widely used due to significant open-source software support: OpenFF-Recharge [@simonboothroyd_openforcefieldopenff-recharge_2023], PsiRESP [@wang_psiresp_2022], PyRESP [@zhao_pyresp_2022], and a standalone Python RESP package [@alenaizan_python_2020]. Alternatively, population analyses (e.g., Mulliken charges [@mulliken_electronic_1955]) and semi-empirical methods (e.g., [@gasteiger_iterative1980; @jakalian_fast_2000]) are well supported by open-source software [@oboyle_open_2011]. More recently, graph neural network (GNN)-based charge assignment tools have garnered interest due to their scalability [@wang_espalomacharge_2024; @adams_graph_2025; @lehner_dash_2023].

In contrast, software support for multipole moment-based charge fitting methods remains sparse despite widespread usage and interest of `psi4/gdma` and MPFIT. Related approached, such as MBIS charges [@mikkelsen_minimal_2025] are typically support by extraction modern QM packages, including Psi4 [@parrish_psi4_2017] and Multiwfn [@lu_multiwfn_2012]. Specialized force field packages, such as AMOEBA's Poltype 2 [@walker_automation_2022] offer multipole-based charge fitting, albeit tightly coupled to specific force field specifications. `pympfit` widely adopts the Open Force Field philosophy "modern, open, extensible, and sustainable" software infrastructure for point charge fitting and parameterization.  

# Software design

`pympfit` originated as a fork of OpenFF-Recharge [@development_2022_7159113], inheriting Open Force Field class hierarchy, design patterns for modular and widely tested codebases. The package comprises of four layers: (1) `gdma`, a `psi4` interface to generate Jinja2-templated GDMA inputs for automated molecular multipole moment generation; (2) `storage`, implemented for an SQLite backend for persistent data across molecules and multiple confomers; (3) `mpfit`, carrying a class of solvers (e.g., singular value decomposition, nonlinear constrained optimization); and (4) `optimize`, a layer to store `ObjectiveTerm` classes for handover of objective functions for advanced algorithms, such as Bayesian virtual site fitting conducted in `pyro`.  

  ![`pympfit` software design consistent of four distinct layers preceding OpenFF-standardized output \label{fig:software_design}](figures/software_design.png)]

The user is exposed to initially a minimal API suite, including `generate_mpfit_charge_parameter` and `generate_global_atom_type_labels`, which accept `openff.toolkit.Molecule` objects and return `LibraryChargeParameter` instances with partial charges and composability with subsequent OpenFF workflows (e.g., `openff-interchange`). Transferable charge assignment across different molecules requires automated atom typing via Morgan fingerprints in RDKit, for which a `radius` of bonds beyond an atom determines the unique chemical environment to be matched.

# Research impact statement

`pympfit` originated as a fork of OpenFF-Recharge [@simonboothroyd_openforcefieldopenff-recharge_2023] and subsequently evolved into a hard fork to serve a growing user base for more curated multipole moment-based partial charge method support. The package as enabled two early research applications to date. First, the MMomentA GNN model [@parmar_shehan807mmomenta_2026] leverages `pympfit` to produce SQLite-based `MoleculeGDMARecord`s of GDMA/MPFIT-based multipole moments and fitted partial charges for  
100, 00 drug-like molecules from the ZINC database [@irwin_zinc_2012]. Moreover, `pympfit` is being used to extend CrystaLattE [@parmar_shehan807crystalatte_2025] to enable rapid crystal lattice energy predictions using molecular mechanics tooling.

# AI usage disclosure

Claude Code (claude-opus-4-5-20251101) assisted with boilerplate documentation, code refactoring, and manuscript revisions and grammar proofing. No generative AI was used for the core MPFIT algorithm or design patterns inherited from openff-recharge. All AI-generated content was critically reviewed, edited, and verified by the authors for technical accuracy.

# Acknowledgements

The authors thank Dr. Matt Thompson, Dr. Lily Wang, Dr. David Mobley, and the Open Force Field team for fruitful discussions, as well as Dr. Sam Ellis (MolSSI) for guidance.

This material is based upon work supported by the U.S. Department of Energy, Office of Science, Office of Advanced Scientific Computing Research, Department of Energy Computational Science Graduate Fellowship under Award Number DE-SC0022158. SMP acknowledges support from the MolSSI Software Science Fellowship.

# References
